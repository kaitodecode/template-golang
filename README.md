# Template Golang Project

Ini adalah template proyek backend menggunakan Go dengan framework Fiber, database PostgreSQL (via GORM), Redis, dan berbagai utilitas lainnya. Proyek ini dirancang untuk aplikasi web sederhana dengan fitur seperti autentikasi, logging, error handling, dan worker untuk tugas background.

## Fitur Utama
- **Web Framework**: Fiber (high-performance web framework mirip Express.js)
- **Database**: PostgreSQL dengan GORM ORM
- **Caching/Queue**: Redis
- **Autentikasi**: JWT-based
- **Logging**: Logrus dengan output ke file dan console
- **Error Handling**: Custom error middleware
- **Validation**: Go-playground/validator
- **File Upload**: S3-compatible (MinIO atau AWS S3)
- **Swagger**: Dokumentasi API otomatis
- **Makefile**: Perintah sederhana untuk development
- **Docker**: docker-compose untuk setup lokal (DB, Redis, Adminer, RedisInsight)

## Persyaratan
- Go 1.24.5 atau lebih baru
- Docker (untuk menjalankan DB dan Redis secara lokal)
- Git

## Instalasi
1. Clone repository:
   ```
   git clone <repo-url>
   cd template-golang
   ```

2. Salin file `.env.example` menjadi `.env` dan sesuaikan nilai-nilainya:
   ```
   cp .env.example .env
   ```

   Contoh isi `.env`:
   ```
   SERVER_PORT=10010
   SERVER_ENV=dev
   DB_HOST=localhost
   DB_PORT=10001
   DB_USER=utschool
   DB_PASSWORD=utschool
   DB_NAME=utschool_db
   REDIS_ADDR=localhost:10003
   REDIS_PASS=utschool
   S3_BUCKET=uts
   S3_REGION=ap-southeast-1
   S3_ACCESS_KEY=your_access_key
   S3_SECRET_KEY=your_secret_key
   S3_ENDPOINT=is3.cloudhost.id
   JWT_SECRET=utschool
   ```

3. Jalankan `make init` untuk install dependencies:
   ```
   make init
   ```

4. Jalankan Docker Compose untuk setup DB dan Redis:
   ```
   docker-compose up -d
   ```

5. Jalankan migrasi database:
   ```
   make migrate-up
   ```

6. Generate dependency injection dengan Wire:
   ```
   make wire
   ```

7. Seed data awal (opsional):
   ```
   make seed
   ```

## Perintah Make
- `make help`: Tampilkan daftar perintah
- `make init`: Install dependencies Go
- `make swagger`: Generate dokumentasi Swagger
- `make api`: Jalankan server API
- `make worker`: Jalankan worker untuk tugas background
- `make air-api`: Jalankan server dengan hot-reload (menggunakan Air)
- `make air-worker`: Jalankan worker dengan hot-reload
- `make seed`: Jalankan seeder database
- `make migrate-create`: Buat file migrasi baru
- `make migrate-up`: Jalankan migrasi up
- `make migrate-down`: Rollback migrasi terakhir
- `make migrate-reset`: Reset semua migrasi
- `make migrate-rollback`: Rollback semua migrasi
- `make migrate-force`: Force set versi migrasi
- `make wire`: Generate wire_gen.go

## Cara Menjalankan
- **Server API**: `make air-api` (atau `make api` tanpa hot-reload)
- **Worker**: `make air-worker` (atau `make worker`)
- Akses Swagger UI: `http://localhost:10010/swagger/index.html`
- Health check: `http://localhost:10010/api/v1/health`

## Struktur Direktori
```
template-golang/
├── .air.toml          # Konfigurasi Air (hot-reload)
├── .env               # Environment variables
├── .env.example       # Contoh .env
├── .github/           # GitHub workflows
├── .gitignore         # Git ignore
├── Dockerfile         # Docker build untuk app
├── Makefile           # Perintah make
├── README.md          # Dokumentasi ini
├── cmd/               # CLI commands (server, worker, seeder)
├── docker-compose.yaml # Setup Docker lokal
├── docs/              # Swagger files
├── go.mod             # Go modules
├── go.sum             # Go sum
├── internal/          # Kode internal (app, db, features, seeders)
│   ├── app.go         # Inisialisasi Fiber app
│   ├── db/            # Database connection, migrations, models
│   ├── features/      # Fitur bisnis (misal users)
│   ├── logs/          # Log files
│   ├── seeders/       # Database seeders
│   ├── wire.go        # Wire dependency injection
│   └── wire_gen.go    # Generated by Wire
├── main.go            # Entry point
├── pkg/               # Packages utilitas
│   ├── apperror/      # Custom error
│   ├── auth/          # Auth utils
│   ├── config/        # Config loader
│   ├── fileUploader/  # S3 file upload
│   ├── helper/        # Helpers (JWT, hash, etc.)
│   ├── logger/        # Logging
│   ├── middleware/    # Fiber middlewares
│   ├── pagination/    # Pagination
│   ├── redisx/        # Redis wrapper
│   ├── response/      # JSON response
│   └── validator/     # Validation
├── sqlc.yaml          # SQLC config (jika digunakan)
└── tmp/               # Temp files (build errors, etc.)
```

## API Endpoints
Dokumentasi lengkap API tersedia via Swagger di `/swagger/index.html`. Beberapa contoh:
- **Users**:
  - POST /api/v1/users/login
  - GET /api/v1/users/me (requires auth)

Tambahkan fitur baru di `internal/features/` dengan struktur handler, service, dto.

## Development Tips
- Gunakan `air` untuk hot-reload selama development.
- Log disimpan di `internal/logs/` per tahun/bulan dalam format JSONL.
- Error handling otomatis log stack trace di dev mode.
- Untuk production, set `SERVER_ENV=prod` untuk logging JSON.

## Kontribusi
1. Fork repository.
2. Buat branch fitur (`git checkout -b feature/AmazingFeature`).
3. Commit changes (`git commit -m 'Add some AmazingFeature'`).
4. Push ke branch (`git push origin feature/AmazingFeature`).
5. Buka Pull Request.

## Lisensi
MIT License. Lihat LICENSE untuk detail.